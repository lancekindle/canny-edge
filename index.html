<!DOCTYPE html>
<html>
<input type="file" id="imgLoader">
<style>
canvas {position:absolute; left:1px; top:1px;}
</style>
<div class="canvas-container" style="width: 50vw; height: 50vh; position: relative; -webkit-user-select: none;">
    <canvas id="canvas" style='width:50vw;height:50vh'></canvas>
</div>

<div class="canvas-container" style="width: 50vw; height: 50vh; position: relative; -webkit-user-select: none;">
    <canvas id="canvas-grey" style='width:50vw;height:50vh'></canvas>
</div>


<div class="canvas-container" style="width: 50vw; height: 50vh; position: relative; -webkit-user-select: none;">
    <canvas id="canvas-3" style='width:50vw;height:50vh'></canvas>
</div>

<div class="canvas-container" style="width: 50vw; height: 50vh; position: relative; -webkit-user-select: none;">
    <canvas id="canvas-edge-x" style='width:50vw;height:50vh'></canvas>
</div>
<div class="canvas-container" style="width: 50vw; height: 50vh; position: relative; -webkit-user-select: none;">
    <canvas id="canvas-edge-y" style='width:50vw;height:50vh'></canvas>
</div>
<div class="canvas-container" style="width: 50vw; height: 50vh; position: relative; -webkit-user-select: none;">
    <canvas id="canvas-edge" style='width:50vw;height:50vh'></canvas>
</div>
<div class="canvas-container" style="width: 50vw; height: 50vh; position: relative; -webkit-user-select: none;">
    <canvas id="bright_color_canv" style='width:50vw;height:50vh'></canvas>
</div>
<div class="canvas-container" style="width: 50vw; height: 50vh; position: relative; -webkit-user-select: none;">
    <canvas id="angle_color_canv" style='width:50vw;height:50vh'></canvas>
</div>

<script>
ZINDEX = 6;
function move_canvas_once(event, ymove, xmove) {
    var element = event.target;
    element.onclick="return true;"; // prevent more clicks from happening on this element
    //move element down (z-index) if it is separating from group
    //if image is heading back into the group, set z-index to global ++ZINDEX
    var eparent = element.parentElement;
    var firstchild = eparent.children[0];
    if (element["z-index"] == 0) {
        element["z-index"] = ++ZINDEX;
        // re-order elements so that this one is last (highest)
        eparent.appendChild(element);
    } else {
        element["z-index"] = 0;
        // re-order elements so that this one is first (lowest)
        eparent.insertBefore(element, firstchild);
    }
    //ymove and xmove are %s to move
    var t = 600, //300 millisecond transition time
        x = xmove / t,
        y = ymove / t,
        original_left = parseInt(element.style.left),  // "50%" => 50
        original_top = parseInt(element.style.top),
        left = original_left,
        top = original_top;
    console.log(element);
    var increment_element_position = function() {
        left += x;
        top += y;
        t -= 1;
        element.style.top = top + "%";
        element.style.left = left + "%";
        if (t != 0) {
            setTimeout(function() { increment_element_position(); }, 3);
        } else { // runs right before fxn ends
            //precisely align image
            element.style.top = (original_top + ymove) + "%";
            element.style.left = (original_left + xmove) + "%";
            //set fxn to move image back to original position
            element.onclick = function(event) {move_canvas_once(event, -ymove, -xmove);
                console.log(element.onclick); };
        }
    }
    setTimeout(function() { increment_element_position(); }, 3);
    return true; // return false to prevent event from reaching other layers
}
</script>

<!-- split angles -->
<div class="canvas-container" style="width: 80vw; height: 80vh; position: relative; -webkit-user-select: none;">
<canvas id="black_canvas" style='width:100%;height:100%'></canvas>
    <div class="canvas-container" style='width:50%;height:50%; position:relative;left:25%;top:25%;'>
        <canvas id="NS_split_angle_canv"
            onclick="move_canvas_once(event,50,50);"; z-index:2; style='width:100%;height:100%;position:absolute;left:0px;top:0px;'></canvas>
        <canvas id="WE_split_angle_canv"
            onclick="move_canvas_once(event,-50,50);"; z-index:3; style='width:100%;height:100%;position:absolute;left:0px;top:0px;'></canvas>
        <canvas id="NE_SW_split_angle_canv"
            onclick="move_canvas_once(event,50,-50);"; z-index:4; style='width:100%;height:100%;position:absolute;left:0px;top:0px;'></canvas>
        <canvas id="NW_SE_split_angle_canv"
                onclick="move_canvas_once(event,-50,-50);"; z-index:5; style='width:100%;height:100%;position:absolute;left:0px;top:0px;'></canvas>
    </div>
</div>

<div class="canvas-container" style="width: 80vw; height: 80vh; position: relative; -webkit-user-select: none;">
<canvas id="black_canvas2" style='width:100%;height:100%'></canvas>
    <div class="canvas-container" style='width:50%;height:50%; position:relative;left:25%;top:25%;'>
        <canvas id="NS_thin_split_angle_canv"
            onclick="move_canvas_once(event,50,50);"; z-index:2; style='width:100%;height:100%;position:absolute;left:0px;top:0px;'></canvas>
        <canvas id="WE_thin_split_angle_canv"
            onclick="move_canvas_once(event,-50,50);"; z-index:3; style='width:100%;height:100%;position:absolute;left:0px;top:0px;'></canvas>
        <canvas id="NE_SW_thin_split_angle_canv"
            onclick="move_canvas_once(event,50,-50);"; z-index:4; style='width:100%;height:100%;position:absolute;left:0px;top:0px;'></canvas>
        <canvas id="NW_SE_thin_split_angle_canv"
                onclick="move_canvas_once(event,-50,-50);"; z-index:5; style='width:100%;height:100%;position:absolute;left:0px;top:0px;'></canvas>
    </div>
</div>

<div class="canvas-container" style="width: 50vw; height: 50vh; position: relative; -webkit-user-select: none;">
    <canvas id="full_magnitude_thin_canv" style='width:50vw;height:50vh'></canvas>
</div>

<script>
function get_strong_weak_input() {
    strong = parseInt(strong_threshold_input.value);
    weak = parseInt(weak_threshold_input.value);
    return [strong, weak];
}

function set_strong_weak_values(strong, weak) {
    // if only one value is defined, check that the other is in bounds and
    // correct value if necessary
    if (weak === undefined) {
        sw = get_strong_weak_input();
        weak = sw[1];
        if (strong <= weak)
            weak = strong - 1;
    }
    if (strong === undefined) {
        sw = get_strong_weak_input();
        strong = sw[0];
        if (strong <= weak)
            strong = weak + 1;
    }
    // now set strong and weak values
    strong_threshold_slider.value = strong;
    strong_threshold_input.value = strong;
    weak_threshold_slider.value = weak;
    weak_threshold_input.value = weak;
}

function apply_threshold_changes(event) {
    sw = get_strong_weak_input();
    strong = sw[0];
    weak = sw[1];
    //call function defined in script ImgProcess.js
    step8_threshold_thin_image(window.steps, strong, weak);
}

function update_weak_threshold(event) {
    var e = event.target;
    var weak = parseInt(e.value);
    set_strong_weak_values(undefined, weak);
    apply_threshold_changes(event);
}

function update_strong_threshold(event) {
    var e = event.target;
    var strong = parseInt(e.value);
    set_strong_weak_values(strong, undefined);
    apply_threshold_changes(event);
}


</script>
<div id="threshold_input_holder">
    <div id="strong_threshold_holder">
        <input id="strong_threshold_slider" type="range" min=1 max=255 value=63
            style="position:relative;" onchange="update_strong_threshold(event);">
        <input id="strong_threshold_input" value=63
        onchange="update_strong_threshold(event)"></input>
    </div>
    <div id="weak_threshold_holder">
        <input id="weak_threshold_slider" type="range" min=0 max=254 value=33
            style="position:relative;" onchange="update_weak_threshold(event);">
        <input id="weak_threshold_input" value=33
        onchange="update_weak_threshold(event)"></input>
    </div>
</div>

<div class="canvas-container" style="width: 50vw; height: 50vh; position: relative; -webkit-user-select: none;">
    <canvas id="strong_threshold_canv" style='width:50vw;height:50vh'></canvas>
</div>
<div class="canvas-container" style="width: 50vw; height: 50vh; position: relative; -webkit-user-select: none;">
    <canvas id="tracked_edges_canv" style='width:50vw;height:50vh'></canvas>
</div>





<script src="Colorwheel.js"></script>
<script src="Canny.js"></script>
<script src="CanvImg.js"></script>
<script src="ImgProcess.js"></script>


</html>
